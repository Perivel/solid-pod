import{renderToStream as t,createComponent as e,renderToStringAsync as n,renderToString as o}from"solid-js/web";import{DateTime as s}from"@swindle/core";import{join as r}from"path";import i from"express";import{renderTags as c}from"solid-meta";const a=(a,l,p=[])=>{const d=i();p.length>0&&d.use(...p);const m=r(process.cwd(),"/dist/public");console.log("Setting asset path to: "+m),d.use(i.static(m)),d.get("*",(async(s,r)=>{const i={server:{debug:"development"===l.env,port:l.port,url:s.url,tags:[]}};if("stream"===l.ssr)t((()=>e(a,{context:i}))).pipe(r);else try{let t;t="async"===l.ssr?await n((()=>e(a,{context:i}))):o((()=>e(a,{context:i}))),r.status(200).send(`\n        <!doctype html>\n        <html lang=${l.lang}>\n          <head>\n          <meta charset=${l.charset} />\n          <meta\n            name="viewport"\n            content="width=device-width, initial-scale=1"\n          />\n          <link\n            rel="shortcut icon"\n            type="image/ico"\n            href="/assets/favicon.ico"\n          />\n          <title>${l.title}</title>\n            ${c(i.server.tags)}\n          </head>\n          <body>\n            <noscript>JavaScript is required to run this app.</noscript>\n            <div id="root">${t}</div>\n            <script type="module" src="scripts/client.js" async><\/script>\n          </body>\n        </html>\n        `)}catch(t){console.log(t.message),r.status(500).send("Server Error")}})),console.log("Starting app"),d.listen(l.port,(()=>console.log(`[${s.Now().toString()}]: Application successfully running on ${l.host}:${l.port}`))).on("error",(t=>{throw t}))};export{a as runServer};

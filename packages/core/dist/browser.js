import{template as t,getNextElement as e,getNextMarker as r,insert as n,isServer as o,createComponent as a,spread as s,effect as l,setAttribute as i,runHydrationEvents as c,mergeProps as u,getNextMatch as h}from"solid-js/web";import{createSignal as p,onCleanup as d,getOwner as f,runWithOwner as g,createMemo as v,createContext as m,useContext as w,createComponent as y,on as b,useTransition as P,untrack as x,resetErrorBoundaries as A,createRenderEffect as E,createRoot as C,Show as L,splitProps as R,mergeProps as S}from"solid-js";import{MetaProvider as j}from"solid-meta";import{Color as K}from"@swindle/color";const O=t("<div><h1>Error: <!#><!/></h1><p></p></div>",8),U=t=>(()=>{const o=e(O),a=o.firstChild,s=a.firstChild.nextSibling,[l,i]=r(s.nextSibling),c=a.nextSibling;return n(a,(()=>t.error.message),l,i),n(c,(()=>t.error.stack)),o})(),$=t("<div></div>",2),k=t=>(()=>{const r=e($);return n(r,(()=>t.content)),r})();function B(t,e,r){return t.addEventListener(e,r),()=>t.removeEventListener(e,r)}function I(t,e){const r=document.getElementById(t);r?r.scrollIntoView():e&&window.scrollTo(0,0)}function N(t,e,r,n){let o=!1;const a=t=>"string"==typeof t?{value:t}:t,s=function([t,e],r,n){return[r?()=>r(t()):t,n?t=>e(n(t)):e]}(p(a(t()),{equals:(t,e)=>t.value===e.value}),void 0,(t=>(!o&&e(t),t)));return r&&d(r(((e=t())=>{o=!0,s[1](a(e)),o=!1}))),{signal:s,utils:n}}const V=/^(?:[a-z0-9]+:)?\/\//i,W=/^\/+|\/+$|\s+/g;function q(t){const e=t.replace(W,"");return e?e.startsWith("?")?e:"/"+e:""}function F(t,e,r){if(V.test(e))return;const n=q(t),o=r&&q(r);let a="";return a=o&&"/"!==e.charAt(0)?0!==o.toLowerCase().indexOf(n.toLowerCase())?n+o:o:n,a+q(e)||"/"}function D(t,e){return q(t).replace(/\/*(\*.*)?$/g,"")+q(e)}function M(t,e){const[r,n]=t.split("/*",2),o=r.split("/").filter(Boolean),a=o.length;return t=>{const r=t.split("/").filter(Boolean),s=r.length-a;if(s<0||s>0&&void 0===n&&!e)return null;const l={path:a?"":"/",params:{}};for(let t=0;t<a;t++){const e=o[t],n=r[t];if(":"===e[0])l.params[e.slice(1)]=n;else if(0!==e.localeCompare(n,void 0,{sensitivity:"base"}))return null;l.path+=`/${n}`}return n&&(l.params[n]=s?r.slice(-s).join("/"):""),l}}function T(t){const[e,r]=t.pattern.split("/*",2),n=e.split("/").filter(Boolean);return n.reduce(((t,e)=>t+(e.startsWith(":")?2:3)),n.length-(void 0===r?0:1))}function z(t){const e=new Map,r=f();return new Proxy({},{get:(n,o)=>(e.has(o)||g(r,(()=>e.set(o,v((()=>t()[o]))))),e.get(o)()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),ownKeys:()=>Reflect.ownKeys(t())})}const G=m(),H=m(),J=()=>function(t,e){if(null==t)throw new Error(e);return t}(w(G),"Make sure your app is wrapped in a <Router />");let Q;const X=()=>Q||w(H)||J().base;function Y(t,e="",r){const{path:n,component:o,data:a,children:s}=t,l=!s||Array.isArray(s)&&!s.length,i=D(e,n),c=l?i:i.split("/*",1)[0];return{originalPath:n,pattern:c,element:o?()=>y(o,{}):()=>{const{element:e}=t;return void 0===e&&r?y(r,{}):e},preload:t.component?o.preload:t.preload,data:a,matcher:M(c,!l)}}function Z(t,e=0){return{routes:t,score:1e4*T(t[t.length-1])-e,matcher(e){const r=[];for(let n=t.length-1;n>=0;n--){const o=t[n],a=o.matcher(e);if(!a)return null;r.unshift({...a,route:o})}return r}}}function _(t,e="",r,n=[],o=[]){const a=Array.isArray(t)?t:[t];for(let t=0,s=a.length;t<s;t++){const s=a[t];if(s&&"object"==typeof s&&s.hasOwnProperty("path")){const t=Y(s,e,r);if(n.push(t),s.children)_(s.children,t.pattern,r,n,o);else{const t=Z([...n],o.length);o.push(t)}n.pop()}}return n.length?o:o.sort(((t,e)=>e.score-t.score))}function tt(t,e="",r,n){const{signal:[a,s],utils:l={}}=function(t){return t?Array.isArray(t)?{signal:t}:t:{signal:p({value:""})}}(t),i=l.parsePath||(t=>t),c=l.renderPath||(t=>t),u=F("",e),h=o&&n?Object.assign(n,{matches:[],url:void 0}):void 0;if(void 0===u)throw new Error(`${u} is not a valid base path`);u&&!a().value&&s({value:u,replace:!0,scroll:!1});const[f,g]=P(),[m,y]=p(a().value),[C,L]=p(a().state),R=function(t,e){const r=new URL("http://sar"),n=v((e=>{const n=t();try{return new URL(n,r)}catch(t){return console.error(`Invalid path ${n}`),e}}),r,{equals:(t,e)=>t.href===e.href}),o=v((()=>n().pathname)),a=v((()=>n().search.slice(1))),s=v((()=>n().hash.slice(1))),l=v((()=>""));return{get pathname(){return o()},get search(){return a()},get hash(){return s()},get state(){return e()},get key(){return l()},query:z(b(a,(()=>function(t){const e={};return t.searchParams.forEach(((t,r)=>{e[r]=t})),e}(n()))))}}(m,C),S=[],j={pattern:u,params:{},path:()=>u,outlet:()=>null,resolvePath:t=>F(u,t)};if(r)try{Q=j,j.data=r({data:void 0,params:{},location:R,navigate:O(j)})}finally{Q=void 0}function K(t,e,r){x((()=>{if("number"==typeof e)return void(e&&(l.go?l.go(e):console.warn("Router integration does not support relative routing")));const{replace:n,resolve:a,scroll:i,state:c}={replace:!1,resolve:!0,scroll:!0,...r},u=a?t.resolvePath(e):F("",e);if(void 0===u)throw new Error(`Path '${e}' is not a routable path`);if(S.length>=100)throw new Error("Too many redirects");const p=m();if(u!==p||c!==C())if(o)h&&(h.url=u),s({value:u,replace:n,scroll:i,state:c});else{const t=S.push({value:p,replace:n,scroll:i,state:C});g((()=>{y(u),L(c),A()})).then((()=>{S.length===t&&function(t){const e=S[0];e&&(t.value===e.value&&t.state===e.state||s({...t,replace:e.replace,scroll:e.scroll}),S.length=0)}({value:u,state:c})}))}}))}function O(t){return t=t||w(H)||j,(e,r)=>K(t,e,r)}if(E((()=>{const{value:t,state:e}=a();t!==x(m)&&g((()=>{y(t),L(e)}))})),!o){function U(t){if(t.defaultPrevented||0!==t.button||t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return;const e=t.composedPath().find((t=>t instanceof Node&&"A"===t.nodeName.toUpperCase()));if(!e)return;const r=e instanceof SVGAElement,n=r?e.href.baseVal:e.href;if((r?e.target.baseVal:e.target)||!n&&!e.hasAttribute("state"))return;const o=(e.getAttribute("rel")||"").split(/\s+/);if(e.hasAttribute("download")||o&&o.includes("external"))return;const a=r?new URL(n,document.baseURI):new URL(n);if(a.origin!==window.location.origin||u&&a.pathname&&!a.pathname.toLowerCase().startsWith(u.toLowerCase()))return;const s=i(a.pathname+a.search+a.hash),l=e.getAttribute("state");t.preventDefault(),K(j,s,{resolve:!1,replace:e.hasAttribute("replace"),scroll:!e.hasAttribute("noscroll"),state:l&&JSON.parse(l)})}document.addEventListener("click",U),d((()=>document.removeEventListener("click",U)))}return{base:j,out:h,location:R,isRouting:f,renderPath:c,parsePath:i,navigatorFactory:O}}function et(t,e,r,n){const{base:o,location:a,navigatorFactory:s}=t,{pattern:l,element:i,preload:c,data:u}=n().route,h=v((()=>n().path)),p=z((()=>n().params));c&&c();const d={parent:e,pattern:l,get child(){return r()},path:h,params:p,data:e.data,outlet:i,resolvePath:t=>F(o.path(),t,h())};if(u)try{Q=d,d.data=u({data:e.data,params:p,location:a,navigate:s(d)})}finally{Q=void 0}return d}const rt=t=>{const{source:e,url:r,base:n,data:s,out:l}=t;var i;const c=tt(e||(o?(i={value:r||""},{signal:[()=>i,t=>Object.assign(i,t)]}):N((()=>({value:window.location.pathname+window.location.search+window.location.hash,state:history.state})),(({value:t,replace:e,scroll:r,state:n})=>{e?window.history.replaceState(n,"",t):window.history.pushState(n,"",t),I(window.location.hash.slice(1),r)}),(t=>B(window,"popstate",(()=>t()))),{go:t=>window.history.go(t)})),n,s,l);return a(G.Provider,{value:c,get children(){return t.children}})},nt=t=>{const e=J(),r=X(),n=v((()=>_(t.children,D(r.pattern,t.base||""),ot))),o=v((()=>function(t,e){for(let r=0,n=t.length;r<n;r++){const n=t[r].matcher(e);if(n)return n}return[]}(n(),e.location.pathname)));e.out&&e.out.matches.push(o().map((({route:t,path:e,params:r})=>({originalPath:t.originalPath,pattern:t.pattern,path:e,params:r}))));const s=[];let l;const i=v(b(o,((t,n,a)=>{let c=n&&t.length===n.length;const u=[];for(let l=0,h=t.length;l<h;l++){const h=n&&n[l],p=t[l];a&&h&&p.route.pattern===h.route.pattern?u[l]=a[l]:(c=!1,s[l]&&s[l](),C((t=>{s[l]=t,u[l]=et(e,u[l-1]||r,(()=>i()[l+1]),(()=>o()[l]))})))}return s.splice(t.length).forEach((t=>t())),a&&c?a:(l=u[0],u)})));return a(L,{get when(){return i()&&l},children:t=>a(H.Provider,{value:t,get children(){return t.outlet()}})})},ot=()=>{const t=X();return a(L,{get when(){return t.child},children:t=>a(H.Provider,{value:t,get children(){return t.outlet()}})})};const at=t=>{let r=t.routes?t.routes:[];const o=t.context.server.url,s=(t.charset&&t.charset,t.lang?t.lang:"en");let l="",c=null;try{l=void 0===(u=t.themeColor)?K.White().hex().value():u instanceof K?u.hex().value():K.FromHex(u).hex().value()}catch(t){c=t}var u;(t=>t.some((t=>t.path="/")))(r)||(t.index?r.push({path:"/",component:()=>t.index}):c=new Error("No index route defined")),c&&(r=[{path:"/",component:()=>a(U,{error:c})}]);const p=((t,e)=>()=>a(nt,{base:e,children:t}))(r),d=t.layout&&!c?t.layout:k;return a(j,{get children(){return a(rt,{url:o,get children(){const t=e(),r=h(t.firstChild,"body").firstChild.nextSibling;return i(t,"lang",s),n(r,a(d,{get content(){return a(p,{})}})),t}})}})};export{k as DefaultLayout,U as SolidusError,at as View};

import{ssr as t,ssrHydrationKey as e,escape as r,isServer as n,createComponent as o,ssrSpread as a,mergeProps as s,NoHydration as i}from"solid-js/web";import{createSignal as l,onCleanup as c,getOwner as u,runWithOwner as h,createMemo as p,createContext as d,useContext as f,createComponent as v,on as g,useTransition as m,untrack as w,resetErrorBoundaries as y,createRenderEffect as b,createRoot as P,Show as x,splitProps as A,mergeProps as E}from"solid-js";import{MetaProvider as L}from"solid-meta";import{Color as R}from"@swindle/color";const j=["<div","><h1>Error: \x3c!--#--\x3e","\x3c!--/--\x3e</h1><p>","</p></div>"],C=n=>t(j,e(),r(n.error.message),r(n.error.stack)),k=["<div",">","</div>"],K=n=>t(k,e(),r(n.content));function O(t,e,r){return t.addEventListener(e,r),()=>t.removeEventListener(e,r)}function U(t,e){const r=document.getElementById(t);r?r.scrollIntoView():e&&window.scrollTo(0,0)}function $(t,e,r,n){let o=!1;const a=t=>"string"==typeof t?{value:t}:t,s=function([t,e],r,n){return[r?()=>r(t()):t,n?t=>e(n(t)):e]}(l(a(t()),{equals:(t,e)=>t.value===e.value}),void 0,(t=>(!o&&e(t),t)));return r&&c(r(((e=t())=>{o=!0,s[1](a(e)),o=!1}))),{signal:s,utils:n}}const S=/^(?:[a-z0-9]+:)?\/\//i,q=/^\/+|\/+$|\s+/g;function B(t){const e=t.replace(q,"");return e?e.startsWith("?")?e:"/"+e:""}function I(t,e,r){if(S.test(e))return;const n=B(t),o=r&&B(r);let a="";return a=o&&"/"!==e.charAt(0)?0!==o.toLowerCase().indexOf(n.toLowerCase())?n+o:o:n,a+B(e)||"/"}function N(t,e){return B(t).replace(/\/*(\*.*)?$/g,"")+B(e)}function V(t,e){const[r,n]=t.split("/*",2),o=r.split("/").filter(Boolean),a=o.length;return t=>{const r=t.split("/").filter(Boolean),s=r.length-a;if(s<0||s>0&&void 0===n&&!e)return null;const i={path:a?"":"/",params:{}};for(let t=0;t<a;t++){const e=o[t],n=r[t];if(":"===e[0])i.params[e.slice(1)]=n;else if(0!==e.localeCompare(n,void 0,{sensitivity:"base"}))return null;i.path+=`/${n}`}return n&&(i.params[n]=s?r.slice(-s).join("/"):""),i}}function W(t){const[e,r]=t.pattern.split("/*",2),n=e.split("/").filter(Boolean);return n.reduce(((t,e)=>t+(e.startsWith(":")?2:3)),n.length-(void 0===r?0:1))}function F(t){const e=new Map,r=u();return new Proxy({},{get:(n,o)=>(e.has(o)||h(r,(()=>e.set(o,p((()=>t()[o]))))),e.get(o)()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),ownKeys:()=>Reflect.ownKeys(t())})}const D=d(),J=d(),M=()=>function(t,e){if(null==t)throw new Error(e);return t}(f(D),"Make sure your app is wrapped in a <Router />");let T;const z=()=>T||f(J)||M().base;function G(t,e="",r){const{path:n,component:o,data:a,children:s}=t,i=!s||Array.isArray(s)&&!s.length,l=N(e,n),c=i?l:l.split("/*",1)[0];return{originalPath:n,pattern:c,element:o?()=>v(o,{}):()=>{const{element:e}=t;return void 0===e&&r?v(r,{}):e},preload:t.component?o.preload:t.preload,data:a,matcher:V(c,!i)}}function H(t,e=0){return{routes:t,score:1e4*W(t[t.length-1])-e,matcher(e){const r=[];for(let n=t.length-1;n>=0;n--){const o=t[n],a=o.matcher(e);if(!a)return null;r.unshift({...a,route:o})}return r}}}function Q(t,e="",r,n=[],o=[]){const a=Array.isArray(t)?t:[t];for(let t=0,s=a.length;t<s;t++){const s=a[t];if(s&&"object"==typeof s&&s.hasOwnProperty("path")){const t=G(s,e,r);if(n.push(t),s.children)Q(s.children,t.pattern,r,n,o);else{const t=H([...n],o.length);o.push(t)}n.pop()}}return n.length?o:o.sort(((t,e)=>e.score-t.score))}function X(t,e="",r,o){const{signal:[a,s],utils:i={}}=function(t){return t?Array.isArray(t)?{signal:t}:t:{signal:l({value:""})}}(t),u=i.parsePath||(t=>t),h=i.renderPath||(t=>t),d=I("",e),v=n&&o?Object.assign(o,{matches:[],url:void 0}):void 0;if(void 0===d)throw new Error(`${d} is not a valid base path`);d&&!a().value&&s({value:d,replace:!0,scroll:!1});const[P,x]=m(),[A,E]=l(a().value),[L,R]=l(a().state),j=function(t,e){const r=new URL("http://sar"),n=p((e=>{const n=t();try{return new URL(n,r)}catch(t){return console.error(`Invalid path ${n}`),e}}),r,{equals:(t,e)=>t.href===e.href}),o=p((()=>n().pathname)),a=p((()=>n().search.slice(1))),s=p((()=>n().hash.slice(1))),i=p((()=>""));return{get pathname(){return o()},get search(){return a()},get hash(){return s()},get state(){return e()},get key(){return i()},query:F(g(a,(()=>function(t){const e={};return t.searchParams.forEach(((t,r)=>{e[r]=t})),e}(n()))))}}(A,L),C=[],k={pattern:d,params:{},path:()=>d,outlet:()=>null,resolvePath:t=>I(d,t)};if(r)try{T=k,k.data=r({data:void 0,params:{},location:j,navigate:O(k)})}finally{T=void 0}function K(t,e,r){w((()=>{if("number"==typeof e)return void(e&&(i.go?i.go(e):console.warn("Router integration does not support relative routing")));const{replace:o,resolve:a,scroll:l,state:c}={replace:!1,resolve:!0,scroll:!0,...r},u=a?t.resolvePath(e):I("",e);if(void 0===u)throw new Error(`Path '${e}' is not a routable path`);if(C.length>=100)throw new Error("Too many redirects");const h=A();if(u!==h||c!==L())if(n)v&&(v.url=u),s({value:u,replace:o,scroll:l,state:c});else{const t=C.push({value:h,replace:o,scroll:l,state:L});x((()=>{E(u),R(c),y()})).then((()=>{C.length===t&&function(t){const e=C[0];e&&(t.value===e.value&&t.state===e.state||s({...t,replace:e.replace,scroll:e.scroll}),C.length=0)}({value:u,state:c})}))}}))}function O(t){return t=t||f(J)||k,(e,r)=>K(t,e,r)}if(b((()=>{const{value:t,state:e}=a();t!==w(A)&&x((()=>{E(t),R(e)}))})),!n){function U(t){if(t.defaultPrevented||0!==t.button||t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return;const e=t.composedPath().find((t=>t instanceof Node&&"A"===t.nodeName.toUpperCase()));if(!e)return;const r=e instanceof SVGAElement,n=r?e.href.baseVal:e.href;if((r?e.target.baseVal:e.target)||!n&&!e.hasAttribute("state"))return;const o=(e.getAttribute("rel")||"").split(/\s+/);if(e.hasAttribute("download")||o&&o.includes("external"))return;const a=r?new URL(n,document.baseURI):new URL(n);if(a.origin!==window.location.origin||d&&a.pathname&&!a.pathname.toLowerCase().startsWith(d.toLowerCase()))return;const s=u(a.pathname+a.search+a.hash),i=e.getAttribute("state");t.preventDefault(),K(k,s,{resolve:!1,replace:e.hasAttribute("replace"),scroll:!e.hasAttribute("noscroll"),state:i&&JSON.parse(i)})}document.addEventListener("click",U),c((()=>document.removeEventListener("click",U)))}return{base:k,out:v,location:j,isRouting:P,renderPath:h,parsePath:u,navigatorFactory:O}}function Y(t,e,r,n){const{base:o,location:a,navigatorFactory:s}=t,{pattern:i,element:l,preload:c,data:u}=n().route,h=p((()=>n().path)),d=F((()=>n().params));c&&c();const f={parent:e,pattern:i,get child(){return r()},path:h,params:d,data:e.data,outlet:l,resolvePath:t=>I(o.path(),t,h())};if(u)try{T=f,f.data=u({data:e.data,params:d,location:a,navigate:s(f)})}finally{T=void 0}return f}const Z=t=>{const{source:e,url:r,base:a,data:s,out:i}=t;var l;const c=X(e||(n?(l={value:r||""},{signal:[()=>l,t=>Object.assign(l,t)]}):$((()=>({value:window.location.pathname+window.location.search+window.location.hash,state:history.state})),(({value:t,replace:e,scroll:r,state:n})=>{e?window.history.replaceState(n,"",t):window.history.pushState(n,"",t),U(window.location.hash.slice(1),r)}),(t=>O(window,"popstate",(()=>t()))),{go:t=>window.history.go(t)})),a,s,i);return o(D.Provider,{value:c,get children(){return t.children}})},_=t=>{const e=M(),r=z(),n=p((()=>Q(t.children,N(r.pattern,t.base||""),tt))),a=p((()=>function(t,e){for(let r=0,n=t.length;r<n;r++){const n=t[r].matcher(e);if(n)return n}return[]}(n(),e.location.pathname)));e.out&&e.out.matches.push(a().map((({route:t,path:e,params:r})=>({originalPath:t.originalPath,pattern:t.pattern,path:e,params:r}))));const s=[];let i;const l=p(g(a,((t,n,o)=>{let c=n&&t.length===n.length;const u=[];for(let i=0,h=t.length;i<h;i++){const h=n&&n[i],p=t[i];o&&h&&p.route.pattern===h.route.pattern?u[i]=o[i]:(c=!1,s[i]&&s[i](),P((t=>{s[i]=t,u[i]=Y(e,u[i-1]||r,(()=>l()[i+1]),(()=>a()[i]))})))}return s.splice(t.length).forEach((t=>t())),o&&c?o:(i=u[0],u)})));return o(x,{get when(){return l()&&i},children:t=>o(J.Provider,{value:t,get children(){return t.outlet()}})})},tt=()=>{const t=z();return o(x,{get when(){return t.child},children:t=>o(J.Provider,{value:t,get children(){return t.outlet()}})})};const et=['<head><meta charset="','"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="','"><link rel="shortcut icon" type="image/ico" href="/assets/favicon.ico"><title>',"</title></head>"],rt=["<html",' lang="','">',"<body><noscript>JavaScript is required to run this app.</noscript><div>",'</div><script type="module" src="js/index.js" async><\/script></body></html>'],nt=n=>{let a=n.routes?n.routes:[];const s=n.context.server.url,l=n.charset?n.charset:"utf-8",c=n.lang?n.lang:"en";let u="",h=null;try{p=n.themeColor,u=void 0===p?R.White().hex().value():p instanceof R?p.hex().value():R.FromHex(p).hex().value()}catch(t){h=t}var p;(t=>t.some((t=>t.path="/")))(a)||(n.index?a.push({path:"/",component:()=>n.index}):h=new Error("No index route defined")),h&&(a=[{path:"/",component:()=>o(C,{error:h})}]);const d=((t,e)=>()=>o(_,{base:e,children:t}))(a),f=n.layout&&!h?n.layout:K;return o(L,{get children(){return o(Z,{url:s,get children(){return t(rt,e(),r(c,!0),i({get children(){return t(et,r(l,!0),r(u,!0),r(n.title))}}),r(o(f,{get content(){return o(d,{})}})))}})}})};export{K as DefaultLayout,C as SolidusError,nt as View};

#!/usr/bin/env node
import{Process as r}from"@swindle/os";import{DateTime as t}from"@swindle/core";import n from"chalk";import{Container as o}from"@swindle/container";import{buildApp as e}from"@solidusjs/utilities";import{Path as s,FileSystem as i}from"@swindle/filesystem";class a{constructor(){}info(r){const t=this.formatMessage(r);console.log(n.green(t))}error(r){const t=this.formatMessage(`Error: ${r}`);console.log(n.red(t))}warn(r){const t=this.formatMessage(r);console.log(n.yellow(t))}formatMessage(r){const n=t.Now();return`[${n.year()}-${n.month()}-${n.day()}] ${r.trim()}`}}const c=new o;var l,u;c.bind(a,(r=>new a)),function(r){r.build="build",r.dev="dev",r.start="start",r.help="-h",r.version="-v"}(l||(l={})),function(r){r[r.Success=0]="Success",r[r.Error=1]="Error"}(u||(u={}));const d=async()=>{const t=r.Cwd(),n=c.get(a);try{return await e({root:t,assetsDir:s.FromSegments(t,"src/assets/**/**"),clientEntryPoint:s.FromSegments(t,"src/client.ts"),outputDir:s.FromSegments(t,"dist"),serverEntryPoint:s.FromSegments(t,"src/server.ts"),onBeforeRollup:async()=>{n.info("Building your application bundle.")},onGenerate:async()=>{n.info("Successfully created your application bundle.")}}),u.Success}catch(r){const t=r;return n.error(t.message),u.Error}};(async()=>{const[n,o,...e]=r.argv,m=e[0];m===l.build?await d():m===l.dev||(m==l.start?await(async()=>{const t=c.get(a),n=r.Cwd(),o=s.FromSegments(n,"dist/index.js");if(!await i.Contains(o)){t.info("Building your application...");const r=await d();if(r===u.Error)return r;t.info("Successfully built application.")}try{t.info("Starting Application..."),await r.Exec(`node ${o.toString()}`,{cwd:n.toString()})}catch(r){const n=r;return t.error(n.message),u.Error}return u.Success})():m==l.help||""==m?await(async()=>{const r=c.get(a),n=`\n      SolidusJS CLI\n      Usage:               solidus <command>\n      -v                   Displays the current version of SolidusJS being run.\n      -h                   Shows this help message.\n\n      Commands\n         build             Builds the application for production.\n         dev               Starts the application in Development Mode.\n         start             Starts the application in production.\n      \n      Â© ${t.Now().year()} Perivel LLC. All rights reserved.\n\n   `;return r.info("\n"+n),u.Success})():m===l.version?await(async()=>(c.get(a).info("0.1.0"),u.Success))():(c.get(a).error("Invalid command."),u.Error))})();

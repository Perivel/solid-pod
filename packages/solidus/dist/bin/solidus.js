#!/usr/bin/env node
import{Process as r}from"@swindle/os";import{DateTime as o}from"@swindle/core";import n from"chalk";import{Container as s}from"@swindle/container";import{buildApp as e}from"@solidusjs/utilities";import{Path as t,FileSystem as i}from"@swindle/filesystem";import{exec as a}from"child_process";class c{constructor(){}info(r){const o=this.formatMessage(r);console.log(n.green(o))}error(r){const o=this.formatMessage(`Error: ${r}`);console.log(n.red(o))}warn(r){const o=this.formatMessage(r);console.log(n.yellow(o))}formatMessage(r){const n=o.Now();return`[${n.year()}-${n.month()}-${n.day()}] ${r.trim()}`}}const l=new s;var u,m;l.bind(c,(r=>new c)),function(r){r.build="build",r.dev="dev",r.start="start",r.help="-h",r.version="-v"}(u||(u={})),function(r){r[r.Success=0]="Success",r[r.Error=1]="Error"}(m||(m={}));const d=async()=>{const o=r.Cwd(),n=l.get(c);try{return await e({root:o,assetsDir:t.FromSegments(o,"src/assets/**/**"),clientEntryPoint:t.FromSegments(o,"src/client.ts"),outputDir:t.FromSegments(o,"dist"),serverEntryPoint:t.FromSegments(o,"src/server.ts"),onBeforeRollup:async()=>{n.info("Building your application bundle.")},onGenerate:async()=>{n.info("Successfully created your application bundle.")}}),m.Success}catch(r){const o=r;return n.error(o.message),m.Error}};(async()=>{const[n,s,...e]=r.argv,p=e[0];p===u.build?await d():p===u.dev||(p==u.start?await(async()=>{const o=l.get(c),n=r.Cwd(),s=t.FromSegments(n,"dist/index.js");if(!await i.Contains(s)){o.info("Building your application...");const r=await d();if(r===m.Error)return r;o.info("Successfully built application.")}try{o.info("Starting Application..."),a(`node ${s.toString()}`,((r,o,n)=>{if(r)throw new Error(r.message);o&&console.log("\n"+o+"\n"),n&&console.log(`\n${n}\n`)}))}catch(r){const n=r;return o.error(n.message),m.Error}return m.Success})():p==u.help||""==p?await(async()=>{const r=l.get(c),n=`\n      SolidusJS CLI\n      Usage:               solidus <command>\n      -v                   Displays the current version of SolidusJS being run.\n      -h                   Shows this help message.\n\n      Commands\n         build             Builds the application for production.\n         dev               Starts the application in Development Mode.\n         start             Starts the application in production.\n      \n      Â© ${o.Now().year()} Perivel LLC. All rights reserved.\n\n   `;return r.info("\n"+n),m.Success})():p===u.version?await(async()=>(l.get(c).info("0.1.6"),m.Success))():(l.get(c).error("Invalid command."),m.Error))})();
